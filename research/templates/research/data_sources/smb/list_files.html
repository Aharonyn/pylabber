{% extends 'base.html' %} 
{% load static %}


{% block content %}

    <link rel="stylesheet" href="{% static "css/tree.css" %}" />

    <h4>
        Remote Resources
    </h4>

    <hr>

    <input id="searchInput" type="text" name="searchInput"><br>

    <a href="{% url 'smb:create' %}"><button class="btn btn-sm">Add</button></a>

    <div id="treeView" class="col-6"></div>



{% endblock content %}

{% block extra-scripts %} 
    <script>
        $(function() {
            // Create lazy loading tree
            $('#treeView').jstree({
                'core' : {
                    'data' : {
                        "url" : "{% url 'smb:lazy_json' %}",
                        "data" : function (node) {
                            return { "id" : node.id };
                        }
                    }
                },
                "plugins" : [ "wholerow", "state", "sort", "search", "contextmenu" ],
                "check_callback" : true,
                "contextmenu": {         
                    "items": function($node) {
                        return {
                            "Sync Children": {
                                "separator_before": false,
                                "separator_after": false,
                                "label": "Sync Children",
                                "action": function (obj) { 
                                    var id = $('#treeView').jstree("get_selected");
                                    $.ajax(
                                        {
                                            type: "GET",
                                            url: "{% url 'smb:ajax_sync_lazy' %}",
                                            data: {
                                                "path_id": id
                                            },
                                            success: function (data) {
                                                console.log(data)
                                                location.reload()
                                            }
                                        }
                                    )
                                }
                            },
                            "Sync Descendants": {
                                "separator_before": false,
                                "separator_after": false,
                                "label": "Sync Descendants",
                                "action": function (obj) { 
                                    var id = $('#treeView').jstree("get_selected");
                                    $.ajax(
                                        {
                                            type: "GET",
                                            url: "{% url 'smb:ajax_sync' %}",
                                            data: {
                                                "path_id": id
                                            },
                                            success: function (data) {
                                                console.log(data)
                                                location.reload()
                                            }
                                        }
                                    )
                                }
                            },
                            "Import Data": {
                                "separator_before": false,
                                "separator_after": false,
                                "label": "Import Data",
                                "action": function (obj) { 
                                    var id = $('#treeView').jstree("get_selected");
                                    $.ajax(
                                        {
                                            type: "GET",
                                            url: "{% url 'research:import_data' %}",
                                            data: {
                                                "node_id": id
                                            },
                                            success: function (data) {
                                                console.log(data)
                                                location.reload()
                                            }
                                        }
                                    )
                                }
                            }
                        };
                    }
                }
            })
            var to = false;
            $('#searchInput').keyup(function () {
                if(to) { clearTimeout(to); }
                to = setTimeout(function () {
                    var v = $('#searchInput').val();
                    $('#treeView').jstree(true).search(v);
                }, 250);
            });
        });
    </script>
{% endblock extra-scripts %}
